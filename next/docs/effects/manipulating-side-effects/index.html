<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bow is a library for Typed Functional Programming in Swift">
    <meta name="keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="" />
    <meta property="og:title" content="Bow" />
    <meta property="og:site_name" content="Bow" />
    <meta property="og:url" content="https://bow-swift.io" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta property="og:keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bow_swift">
    <meta name="twitter:creator" content="@bow_swift">
    <meta name="twitter:image" content="https://bow-swift.io/img/twitter-card.png" />

    <!-- Bow version metadata -->
    
    <meta name="bow-version" data-title="next" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/next/img/favicon.png">
    <!-- Main css -->
    <link rel="stylesheet" type="text/css" href="/next/css/docs.css">
    <!-- Highlighting css -->
    <link rel="stylesheet" type="text/css" href="/next/api-docs/css/highlight.css">

    <!-- Code to manage version information -->
    <script src="/next/js/doc-versions.js" defer></script>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18433785-19"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18433785-19');
</script>

    

</head>

<body id="doc-body">
<div id="wrapper">
    <div id="sidebar-wrapper">
    <div class="sidebar-brand">
        <a class="brand" href="/next/">
            <img src="/next/img/icon.svg" alt="Bow logo">
            <span>Bow</span>
        </a>
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <span class="close"></span>
        </button>
    </div>

    <div id="version-dropdown">

    <button class="button link-like" onclick="displayToggle(event)" title="Documentation">
      <span>Bow version</span>
      <span id="bow-version">
        
        next
      </span>
    </button>

    <ul class="dropdown dropdown-content">

      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/docs">
            <span>
              0.6.0
            </span>
        </a>
      </li>

      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/next/docs">
            <span>
              next
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.4.0/docs">
            <span>
              0.4.0
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.5.0/docs">
            <span>
              0.5.0
            </span>
        </a>
      </li>
      
    </ul>
</div>


    <ul class="sidebar-nav">
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Quick start</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/quick-start/getting-started/">
                        <i class="fa fa-circle"></i>
                        <span>Getting started</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/modules/">
                        <i class="fa fa-circle"></i>
                        <span>Modules</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/resources/">
                        <i class="fa fa-circle"></i>
                        <span>Resources</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>FP concepts</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/fp-concepts/glossary/">
                        <i class="fa fa-circle"></i>
                        <span>Glossary</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/functions-vs-procedures/">
                        <i class="fa fa-circle"></i>
                        <span>Functions vs Procedures</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/higher-kinded-types/">
                        <i class="fa fa-circle"></i>
                        <span>Higher Kinded Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/type-classes/">
                        <i class="fa fa-circle"></i>
                        <span>Type classes</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/data-types/">
                        <i class="fa fa-circle"></i>
                        <span>Data types</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Patterns</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/patterns/error-handling/">
                        <i class="fa fa-circle"></i>
                        <span>Error handling</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/monad-comprehensions/">
                        <i class="fa fa-circle"></i>
                        <span>Monad comprehensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/dependency-injection/">
                        <i class="fa fa-circle"></i>
                        <span>Dependency injection</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/polymorphic-programs/">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphic programs</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Optics</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/optics/overview/">
                        <i class="fa fa-circle"></i>
                        <span>Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/writing-your-own-optics/">
                        <i class="fa fa-circle"></i>
                        <span>Writing your own optics</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/automatic-derivation/">
                        <i class="fa fa-circle"></i>
                        <span>Automatic derivation</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/composition/">
                        <i class="fa fa-circle"></i>
                        <span>Composition</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Effects</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/effects/overview/">
                        <i class="fa fa-circle"></i>
                        <span>Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/suspending-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Suspending side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/manipulating-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Manipulating side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-errors/">
                        <i class="fa fa-circle"></i>
                        <span>Handling errors</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/concurrency/">
                        <i class="fa fa-circle"></i>
                        <span>Concurrency</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/running-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Running side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-resources/">
                        <i class="fa fa-circle"></i>
                        <span>Handling resources</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/foundation-extensions/">
                        <i class="fa fa-circle"></i>
                        <span>Foundation extensions</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Integrations</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/integrations/rxswift-streams/">
                        <i class="fa fa-circle"></i>
                        <span>RxSwift streams</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Legal</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/legal/credits/">
                        <i class="fa fa-circle"></i>
                        <span>Credits</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/legal/license/">
                        <i class="fa fa-circle"></i>
                        <span>License</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
    </ul>
</div>

    <div id="doc-wrapper">
    <div class="doc-header">
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <i class="fa fa-lg fa-bars menu-icon"></i>
        </button>
    </div>
    <div class="doc-content">
        <h1 id="manipulating-side-effects">Manipulating side effects</h1>

<p class="beginner">beginner</p>

<p>Once effects have been suspended in an <code class="highlighter-rouge">IO</code> data type, we can use different combinators to manipulate the enclosed data. This section explores the different operations that we can perform over one or several <code class="highlighter-rouge">IO</code> values.</p>

<h2 id="transforming-data">Transforming data</h2>

<p>An <code class="highlighter-rouge">IO&lt;E, A&gt;</code> value describes a computation that will eventually produce a value of type <code class="highlighter-rouge">A</code> or cause an error of type <code class="highlighter-rouge">E</code>. For instance, if we want to retrieve data from a network request using the extensions that Bow Effects adds over <code class="highlighter-rouge">URLSession</code>, we would get an <code class="highlighter-rouge">IO&lt;Error, (URLResponse, Data)&gt;</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="p">(</span><span class="nv">response</span><span class="p">:</span> <span class="kt">URLResponse</span><span class="p">,</span> <span class="nv">data</span><span class="p">:</span> <span class="kt">Data</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskIO</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>
</code></pre></div></div>

<p>However, what we would need is, instead of <code class="highlighter-rouge">Data</code>, the <code class="highlighter-rouge">String</code> representation of such data. We could be tempted to run the computation, extract the <code class="highlighter-rouge">Data</code> and start manipulating it. However, this will not be too different from running the non-functional version of <code class="highlighter-rouge">URLSession.dataTask</code>, as we would be performing side effects.</p>

<p>Our goal is to keep side effects suspended and only run them <em>at the edge of the world</em>; that is, in the outer layers of our application where we have them all under control. Then, how can we manipulate the values wrapped in an <code class="highlighter-rouge">IO</code>?</p>

<p>The answer is a combinator that you have probably seen in several other data types: the <code class="highlighter-rouge">map</code> combinator. <code class="highlighter-rouge">IO</code> has an instance of <code class="highlighter-rouge">Functor</code>; therefore, <code class="highlighter-rouge">map</code> is available to be used. In our example, we can perform a <code class="highlighter-rouge">map</code> to obtain the <code class="highlighter-rouge">Data</code> out of the tuple, and sequence another <code class="highlighter-rouge">map</code> to convert it to a <code class="highlighter-rouge">String</code>:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">stringIO</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="n">request</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span>
           <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">??</span> <span class="s">""</span> <span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<h2 id="combining-independent-computations">Combining independent computations</h2>

<p>We can wrap the previous operation into a function that fetches the HTML code of a website:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">fetchHTML</span><span class="p">(</span><span class="n">from</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="nf">dataTaskIO</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">result</span> <span class="k">in</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span> <span class="p">}</span>
        <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">data</span> <span class="k">in</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">??</span> <span class="s">""</span> <span class="p">}</span><span class="o">^</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Let’s say that now we need to fetch the HTML code from multiple URLs. Each fetching operation is independent from each other. How can we run multiple <code class="highlighter-rouge">IO</code> operations that are independent? The answer is the <code class="highlighter-rouge">zip</code> combinator, present in <code class="highlighter-rouge">Applicative</code>. This combinator performs the different <code class="highlighter-rouge">IO</code> operations and returns a single <code class="highlighter-rouge">IO</code> that tuples the results:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">html</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="kt">IO</span><span class="o">.</span><span class="nf">zip</span><span class="p">(</span><span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
           <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.apple.com"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
           <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span><span class="o">^</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">zip</code> combinator is overloaded to work from 2 to 9 operations. If any of the operations above fails, the failure is reported. If all succeed, the tuple with the three results is returned. Note that even though the computations are run independently, that does not mean they are run concurrently. This is possible with <code class="highlighter-rouge">IO</code> though, and you can find more information about it in the <strong>Concurrent and Asynchronous execution</strong> section.</p>

<p>If you want to combine the results of the independent computations, <code class="highlighter-rouge">IO</code> also provides a <code class="highlighter-rouge">map</code> function that accepts a closure at the end to combine the results. For instance, instead of tupling the three results, we may want to wrap them in an array:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">html2</span> <span class="o">=</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span><span class="o">&gt;.</span><span class="nf">map</span><span class="p">(</span>
    <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
    <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.apple.com"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
    <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span> <span class="p">{</span> <span class="n">bow</span><span class="p">,</span> <span class="n">apple</span><span class="p">,</span> <span class="n">github</span> <span class="k">in</span>
        <span class="p">[</span><span class="n">bow</span><span class="p">,</span> <span class="n">apple</span><span class="p">,</span> <span class="n">github</span><span class="p">]</span>
    <span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<p>As with <code class="highlighter-rouge">zip</code>, <code class="highlighter-rouge">map</code> is overloaded to work from 2 to 9 parameters and will provide an error if any of the operations fails. It does not run the computations concurrently, but it has a counterpart that does it.</p>

<h2 id="sequencing-dependent-computations">Sequencing dependent computations</h2>

<p>So far, we have been able to run <code class="highlighter-rouge">IO</code> computations that do not depend on each other. But how can we chain <code class="highlighter-rouge">IO</code> computations that need to use the output of other computations? In our running example, let’s say that we want to print to the standard output a message with the length of the HTML that we have fetched. Fetching HTML and printing are 2 side-effectful operations, but printing the log needs the result of fetching HTML; therefore, there is a dependency between them.</p>

<p>In order to chain dependent computations, <code class="highlighter-rouge">IO</code> provides a method that you may already be familiar with from other types: the <code class="highlighter-rouge">flatMap</code> combinator. This combinator is part of <code class="highlighter-rouge">Monad</code> and <code class="highlighter-rouge">IO</code> has an instance for it.</p>

<p>Therefore, we can pass the fetched HTML code to the print function using:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">program</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">Void</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">html</span> <span class="k">in</span>
    <span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Received </span><span class="se">\(</span><span class="n">html</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters."</span><span class="p">)</span>
<span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<p>We can also print something before starting to fetch the HTML code:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">program2</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">Void</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Fetching Bow's main page"</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">_</span> <span class="k">in</span>
    <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">html</span> <span class="k">in</span>
        <span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Received </span><span class="se">\(</span><span class="n">html</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters."</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<p>This program chains different <code class="highlighter-rouge">IO</code> computations that are dependent from each other and need to happen in a specific order. However there is an improvement that we can do to it using some utility function based on <code class="highlighter-rouge">flatMap</code>.</p>

<p>The first one is the usage of the function <code class="highlighter-rouge">followedBy</code>. This function lets us sequence 2 effects, where the second one needs to happen after the first, but does not need the output of the first. That is the kind of dependency we have between our first <code class="highlighter-rouge">print</code> and the fetch operation: they need to happen in that order, but <code class="highlighter-rouge">fetchHTML</code> does not consume anything produced from the <code class="highlighter-rouge">print</code>. You can notice it above since the wildcard <code class="highlighter-rouge">_</code> is used in the first <code class="highlighter-rouge">flatMap</code> operation.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">program3</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">Void</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Fetching Bow's main page"</span><span class="p">)</span><span class="o">.</span><span class="nf">followedBy</span><span class="p">(</span>
    <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span><span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span> <span class="n">html</span> <span class="k">in</span>
        <span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Received </span><span class="se">\(</span><span class="n">html</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters."</span><span class="p">)</span>
    <span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<h3 id="monad-comprehensions">Monad comprehensions</h3>

<p>Chaining computations is possible thanks to <code class="highlighter-rouge">flatMap</code> but it can become cumbersome quickly as the nesting of <code class="highlighter-rouge">flatMap</code> quickly becomes difficult to read. To solve this issue, Bow provides <strong>Monad comprehensions</strong>, that you can read more about in its dedicated section.</p>

<p>In summary, Monad comprehensions provide a better syntax in imperative-like style to chain computations. The program above can be rewritten as:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">htmlCode</span> <span class="o">=</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;.</span><span class="k">var</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">program4</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">Void</span><span class="o">&gt;</span> <span class="o">=</span> <span class="nf">binding</span><span class="p">(</span>
             <span class="o">|&lt;-</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Fetching Bow's main page"</span><span class="p">),</span>
    <span class="n">htmlCode</span> <span class="o">&lt;-</span> <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
             <span class="o">|&lt;-</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Received </span><span class="se">\(</span><span class="n">htmlCode</span><span class="o">.</span><span class="k">get</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters."</span><span class="p">),</span>
    <span class="nv">yield</span><span class="p">:</span> <span class="p">()</span>
<span class="p">)</span><span class="o">^</span>
</code></pre></div></div>

<p>This syntax enables an easier way to compose different computations and is simpler to read and maintain.</p>

    </div>
</div>

</div>
<!-- Custom scripts for this template -->
<script src="/next/js/docs.js"></script>
<!-- Gitter -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'bowswift/bow'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

</body>
</html>
