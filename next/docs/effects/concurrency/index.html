<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Bow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Bow is a library for Typed Functional Programming in Swift">
    <meta name="keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory">

    <meta property="og:image" content="" />
    <meta property="og:title" content="Bow" />
    <meta property="og:site_name" content="Bow" />
    <meta property="og:url" content="https://bow-swift.io" />
    <meta property="og:type" content="website" />
    <meta property="og:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta property="og:keywords" content="functional-programming, swift-library, monads, monad-transformers, functional-data-structure, swift, fp-types, adt, free-monads, tagless-final, mtl, for-comprehension, category-theory" />

    <meta name="twitter:text:description" content="Bow is a library for Typed Functional Programming in Swift" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@bow_swift">
    <meta name="twitter:creator" content="@bow_swift">
    <meta name="twitter:image" content="https://bow-swift.io/img/twitter-card.png" />

    <!-- Bow version metadata -->
    
    <meta name="bow-version" data-title="next" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/next/img/favicon.png">
    <!-- Main css -->
    <link rel="stylesheet" type="text/css" href="/next/css/docs.css">
    <!-- Highlighting css -->
    <link rel="stylesheet" type="text/css" href="/next/api-docs/css/highlight.css">

    <!-- Code to manage version information -->
    <script src="/next/js/doc-versions.js" defer></script>

    
        <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-18433785-19"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-18433785-19');
</script>

    

</head>

<body id="doc-body">
<div id="wrapper">
    <div id="sidebar-wrapper">
    <div class="sidebar-brand">
        <a class="brand" href="/next/">
            <img src="/next/img/icon.svg" alt="Bow logo">
            <span>Bow</span>
        </a>
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <span class="close"></span>
        </button>
    </div>

    <div id="version-dropdown">

    <button class="button link-like" onclick="displayToggle(event)" title="Documentation">
      <span>Bow version</span>
      <span id="bow-version">
        
        next
      </span>
    </button>

    <ul class="dropdown dropdown-content">

      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/docs">
            <span>
              0.6.0
            </span>
        </a>
      </li>

      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/next/docs">
            <span>
              next
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.4.0/docs">
            <span>
              0.4.0
            </span>
        </a>
      </li>
      
      <li class="dropdown-item">
        <a class="dropdown-item-link" href="/0.5.0/docs">
            <span>
              0.5.0
            </span>
        </a>
      </li>
      
    </ul>
</div>


    <ul class="sidebar-nav">
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Quick start</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/quick-start/getting-started/">
                        <i class="fa fa-circle"></i>
                        <span>Getting started</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/modules/">
                        <i class="fa fa-circle"></i>
                        <span>Modules</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/quick-start/resources/">
                        <i class="fa fa-circle"></i>
                        <span>Resources</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>FP concepts</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/fp-concepts/glossary/">
                        <i class="fa fa-circle"></i>
                        <span>Glossary</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/functions-vs-procedures/">
                        <i class="fa fa-circle"></i>
                        <span>Functions vs Procedures</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/higher-kinded-types/">
                        <i class="fa fa-circle"></i>
                        <span>Higher Kinded Types</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/type-classes/">
                        <i class="fa fa-circle"></i>
                        <span>Type classes</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/fp-concepts/data-types/">
                        <i class="fa fa-circle"></i>
                        <span>Data types</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Patterns</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/patterns/error-handling/">
                        <i class="fa fa-circle"></i>
                        <span>Error handling</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/monad-comprehensions/">
                        <i class="fa fa-circle"></i>
                        <span>Monad comprehensions</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/dependency-injection/">
                        <i class="fa fa-circle"></i>
                        <span>Dependency injection</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/patterns/polymorphic-programs/">
                        <i class="fa fa-circle"></i>
                        <span>Polymorphic programs</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Optics</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/optics/overview/">
                        <i class="fa fa-circle"></i>
                        <span>Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/writing-your-own-optics/">
                        <i class="fa fa-circle"></i>
                        <span>Writing your own optics</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/automatic-derivation/">
                        <i class="fa fa-circle"></i>
                        <span>Automatic derivation</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/optics/composition/">
                        <i class="fa fa-circle"></i>
                        <span>Composition</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Effects</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/effects/overview/">
                        <i class="fa fa-circle"></i>
                        <span>Overview</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/suspending-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Suspending side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/manipulating-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Manipulating side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-errors/">
                        <i class="fa fa-circle"></i>
                        <span>Handling errors</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/concurrency/">
                        <i class="fa fa-circle"></i>
                        <span>Concurrency</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/running-side-effects/">
                        <i class="fa fa-circle"></i>
                        <span>Running side effects</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/handling-resources/">
                        <i class="fa fa-circle"></i>
                        <span>Handling resources</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/effects/foundation-extensions/">
                        <i class="fa fa-circle"></i>
                        <span>Foundation extensions</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Integrations</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/integrations/rxswift-streams/">
                        <i class="fa fa-circle"></i>
                        <span>RxSwift streams</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
        <li class="sidebar-nav-item">
            <a href="#">
                <span>Legal</span>
                
                <i class="fa fa-angle-right"></i>
                
            </a>
            
            <ul>
                
                <li>
                    <a href="/next/docs/legal/credits/">
                        <i class="fa fa-circle"></i>
                        <span>Credits</span>
                    </a>
                </li>
                
                <li>
                    <a href="/next/docs/legal/license/">
                        <i class="fa fa-circle"></i>
                        <span>License</span>
                    </a>
                </li>
                
            </ul>
            
        </li>
        
    </ul>
</div>

    <div id="doc-wrapper">
    <div class="doc-header">
        <button type="button" id="main-toggle" class="sidebar-toggle">
            <i class="fa fa-lg fa-bars menu-icon"></i>
        </button>
    </div>
    <div class="doc-content">
        <h1 id="concurrency">Concurrency</h1>

<p class="intermediate">intermediate</p>

<p><code class="highlighter-rouge">IO</code> is a data type that suspends side effects and provides support to work with them in an asynchronous and concurrent manner. This section explores the utilites that it offers to facilitate this task.</p>

<h2 id="switching-execution-context">Switching execution context</h2>

<p>Oftentimes we need to perform certain tasks on a background thread in order not to block the main thread, whose intended use is rendering the user interface. This is usually done with the Grand Central Dispatch, and, in particular, with the <code class="highlighter-rouge">DispatchQueue</code>.</p>

<p>The main issue is that the API of <code class="highlighter-rouge">DispatchQueue</code> is difficult to compose. <code class="highlighter-rouge">IO</code> provides utilites to switch to a different queue and continue chaining computations with the <code class="highlighter-rouge">continueOn</code> method from the <code class="highlighter-rouge">Async</code> type class.</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">program</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Never</span><span class="p">,</span> <span class="kt">Void</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">shift</span><span class="p">()</span>
        <span class="o">.</span><span class="nf">followedBy</span><span class="p">(</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Hello from the main queue"</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">continueOn</span><span class="p">(</span><span class="o">.</span><span class="nf">global</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">background</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">followedBy</span><span class="p">(</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Hello from the background queue"</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">continueOn</span><span class="p">(</span><span class="kt">DispatchQueue</span><span class="p">(</span><span class="nv">label</span><span class="p">:</span> <span class="s">"my-queue"</span><span class="p">))</span>
        <span class="o">.</span><span class="nf">followedBy</span><span class="p">(</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Hello from my custom queue"</span><span class="p">))</span><span class="o">^</span>
</code></pre></div></div>

<h2 id="running-computations-in-parallel">Running computations in parallel</h2>

<p><code class="highlighter-rouge">IO</code> lets us run several independent computations using <code class="highlighter-rouge">zip</code>. However, this method won’t run them in parallel. To achieve this behavior, there is a method called <code class="highlighter-rouge">parZip</code>, from the <code class="highlighter-rouge">Concurrent</code> type class.</p>

<p>For example, we may have a function to fetch the HTML code from a website:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">func</span> <span class="nf">fetchHTML</span><span class="p">(</span><span class="n">from</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Using <code class="highlighter-rouge">parZip</code> we can fetch all three in parallel and get their results in a tuple:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">result</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="p">(</span><span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="kt">IO</span><span class="o">.</span><span class="nf">parZip</span><span class="p">(</span><span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
              <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https:www.apple.com"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
              <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span><span class="o">^</span>
</code></pre></div></div>

<p>The <code class="highlighter-rouge">parZip</code> method is overloaded to work from 2 to 9 parameters. If, instead of getting a tuple, you want to do some transformation to the data that you are receiving, you can use the <code class="highlighter-rouge">parMap</code> function from the <code class="highlighter-rouge">Concurrent</code> type class. In our previous example, we may want to create an array of values with the HTML contents of all the requests:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">result2</span><span class="p">:</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="p">[</span><span class="kt">String</span><span class="p">]</span><span class="o">&gt;</span> <span class="o">=</span>
    <span class="kt">IO</span><span class="o">.</span><span class="nf">parMap</span><span class="p">(</span><span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
              <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https:www.apple.com"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
              <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span> <span class="p">{</span> <span class="n">bow</span><span class="p">,</span> <span class="n">apple</span><span class="p">,</span> <span class="n">github</span> <span class="k">in</span>
                <span class="p">[</span><span class="n">bow</span><span class="p">,</span> <span class="n">apple</span><span class="p">,</span> <span class="n">github</span><span class="p">]</span>
    <span class="p">}</span><span class="o">^</span>
</code></pre></div></div>

<h2 id="monad-comprehensions">Monad comprehensions</h2>

<p>The operations above play nicely with Monad comprehensions. You can easily change to a different <code class="highlighter-rouge">DispatchQueue</code> using the <code class="highlighter-rouge">continueOn</code> function and run computations in parallel using the <code class="highlighter-rouge">parallel</code> function. You can also assign tuples and get destructuring of each of their components.</p>

<p>For instance, we can fetch the three previous websites in parallel in a background queue and then print their number of characters sequentially in the main queue:</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">let</span> <span class="nv">bow</span> <span class="o">=</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;.</span><span class="k">var</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">apple</span> <span class="o">=</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;.</span><span class="k">var</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">github</span> <span class="o">=</span> <span class="kt">IO</span><span class="o">&lt;</span><span class="kt">Error</span><span class="p">,</span> <span class="kt">String</span><span class="o">&gt;.</span><span class="k">var</span><span class="p">()</span>

<span class="k">let</span> <span class="nv">websites</span> <span class="o">=</span> <span class="nf">binding</span><span class="p">(</span>
    <span class="nf">continueOn</span><span class="p">(</span><span class="o">.</span><span class="nf">global</span><span class="p">(</span><span class="nv">qos</span><span class="p">:</span> <span class="o">.</span><span class="n">background</span><span class="p">)),</span>
    <span class="p">(</span><span class="n">bow</span><span class="p">,</span> <span class="n">apple</span><span class="p">,</span> <span class="n">github</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="nf">parallel</span><span class="p">(</span><span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://bow-swift.io"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
                                     <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https:www.apple.com"</span><span class="p">)</span><span class="o">!</span><span class="p">),</span>
                                     <span class="nf">fetchHTML</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://github.com"</span><span class="p">)</span><span class="o">!</span><span class="p">)),</span>
    <span class="nf">continueOn</span><span class="p">(</span><span class="o">.</span><span class="n">main</span><span class="p">),</span>
    <span class="o">|&lt;-</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Bow has </span><span class="se">\(</span><span class="n">bow</span><span class="o">.</span><span class="k">get</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters"</span><span class="p">),</span>
    <span class="o">|&lt;-</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"Apple has </span><span class="se">\(</span><span class="n">apple</span><span class="o">.</span><span class="k">get</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters"</span><span class="p">),</span>
    <span class="o">|&lt;-</span><span class="kt">ConsoleIO</span><span class="o">.</span><span class="nf">print</span><span class="p">(</span><span class="s">"GitHub has </span><span class="se">\(</span><span class="n">github</span><span class="o">.</span><span class="k">get</span><span class="o">.</span><span class="n">count</span><span class="se">)</span><span class="s"> characters"</span><span class="p">),</span>
    <span class="nv">yield</span><span class="p">:</span> <span class="p">()</span>
<span class="p">)</span>
</code></pre></div></div>

<p>For further information about how Monad comprehensions work in Bow, please refer to its documentation page.</p>

    </div>
</div>

</div>
<!-- Custom scripts for this template -->
<script src="/next/js/docs.js"></script>
<!-- Gitter -->
<script>
  ((window.gitter = {}).chat = {}).options = {
    room: 'bowswift/bow'
  };
</script>
<script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>

</body>
</html>
